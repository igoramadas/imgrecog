<!DOCTYPE html>

<html>
<head>
  <title>index.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>index.coffee</h1>
        

        
      </div>

      
        
        
        
          <div class='highlight'><pre>async = <span class="hljs-built_in">require</span> <span class="hljs-string">"async"</span>
fs = <span class="hljs-built_in">require</span> <span class="hljs-string">"fs"</span>
path = <span class="hljs-built_in">require</span> <span class="hljs-string">"path"</span>
vision = <span class="hljs-built_in">require</span> <span class="hljs-string">"@google-cloud/vision"</span>
client = <span class="hljs-literal">null</span></pre></div>
        
      
        
        <p>Get current and bin executable folder.</p>

        
          <div class='highlight'><pre>currentFolder = process.cwd() + <span class="hljs-string">"/"</span>
executableFolder = path.dirname(<span class="hljs-built_in">require</span>.main.filename) + <span class="hljs-string">"/"</span></pre></div>
        
      
        
        <p>Collection of image models.</p>

        
          <div class='highlight'><pre>images = {}</pre></div>
        
      
        
        <p>Collection of folders to scan.</p>

        
          <div class='highlight'><pre>folders = []</pre></div>
        
      
        
        <p>Create file processor queue  to parse files against Google Vision.</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">queueProcessor</span> = <span class="hljs-params">(filepath, callback)</span> -&gt;</span> scanFile filepath, callback
fileQueue = async.queue queueProcessor, <span class="hljs-number">4</span></pre></div>
        
      
        
        <p>File processor queue will drain once we have processed all files.</p>

        
          <div class='highlight'><pre>fileQueue.drain = <span class="hljs-function">-&gt;</span> finished()</pre></div>
        
      
        
        <p>Default options.</p>

        
          <div class='highlight'><pre>options = {
    decimals: <span class="hljs-number">2</span>
    extensions: [<span class="hljs-string">"png"</span>, <span class="hljs-string">"jpg"</span>, <span class="hljs-string">"gif"</span>, <span class="hljs-string">"bpm"</span>, <span class="hljs-string">"raw"</span>, <span class="hljs-string">".webp"</span>]
    faces: <span class="hljs-literal">false</span>
    labels: <span class="hljs-literal">false</span>
    landmarks: <span class="hljs-literal">false</span>
    logos: <span class="hljs-literal">false</span>
    overwrite: <span class="hljs-literal">false</span>
    safe: <span class="hljs-literal">false</span>
    verbose: <span class="hljs-literal">false</span>
}</pre></div>
        
      
        
        <p>Transforms safe search strings to score.</p>

        
          <div class='highlight'><pre>likelyhood = {
    VERY_UNLIKELY: <span class="hljs-number">0</span>
    UNLIKELY: <span class="hljs-number">0.15</span>
    POSSIBLE: <span class="hljs-number">0.45</span>
    LIKELY: <span class="hljs-number">0.75</span>
    VERY_LIKELY: <span class="hljs-number">0.95</span>
}</pre></div>
        
      
        
        <p>Set start time (Unix timestamp).</p>

        
          <div class='highlight'><pre>startTime = Date.now()</pre></div>
        
      
        
        <p>Show help on command line (imgrecog.js -help).</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">showHelp</span> = -&gt;</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"imgrecog.js &lt;options&gt; &lt;folders&gt;"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -faces             detect faces"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -labels            detect labels"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -landmarks         detect landmarks"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -logos             detect logos"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -safe              detect safe search"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -all               detect all (same as enabling everything above)"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -overwrite   -w    reprocess existing files / overwrite tags"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -verbose     -v    enable verbose"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  -help        -h    help me (this screen)"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Examples:"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Detect labels and safe search on current directory"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  $ imgrecog.js -labels -safe"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Detect everything and overwrite tags on specific directories"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"  $ imgrecog.js -all -w /home/someuser/images /home/someuser/photos"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span></pre></div>
        
      
        
        <p>Get parameters from command line.</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">getParams</span> = -&gt;</span>
    params = Array::slice.call process.argv, <span class="hljs-number">2</span></pre></div>
        
      
        
        <p>No parameters? Show help.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> params.length <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
        showHelp()
        <span class="hljs-keyword">return</span> process.exit <span class="hljs-number">0</span></pre></div>
        
      
        
        <p>Check paramsâ€¦</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> params
        <span class="hljs-keyword">switch</span> p
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-h"</span>, <span class="hljs-string">"-help"</span>
                showHelp()
                <span class="hljs-keyword">return</span> process.exit <span class="hljs-number">0</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-v"</span>, <span class="hljs-string">"-verbose"</span>
                options.verbose = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-w"</span>, <span class="hljs-string">"-overwrite"</span>
                options.overwrite = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-all"</span>
                options.faces = <span class="hljs-literal">true</span>
                options.labels = <span class="hljs-literal">true</span>
                options.landmarks = <span class="hljs-literal">true</span>
                options.logos = <span class="hljs-literal">true</span>
                options.safe = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-faces"</span>
                options.faces = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-labels"</span>
                options.labels = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-landmarks"</span>
                options.landmarks = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-logos"</span>
                options.logos = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">when</span> <span class="hljs-string">"-safe"</span>
                options.safe = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">else</span>
                folders.push p</pre></div>
        
      
        
        <p>Exit if no folders were passed, search on current directory.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> folders.length &lt; <span class="hljs-number">1</span>
        folders.push currentFolder
        <span class="hljs-keyword">return</span> process.exit <span class="hljs-number">0</span>

    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> folders
        <span class="hljs-keyword">if</span> f.substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) <span class="hljs-keyword">is</span> <span class="hljs-string">"-"</span>
            <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Abort! Invalid option: <span class="hljs-subst">#{f}</span>. Use -help to get a list of available options."</span>
            <span class="hljs-keyword">return</span> process.exit <span class="hljs-number">0</span></pre></div>
        
      
        
        <p>Scan and process image file.</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">scanFile</span> = <span class="hljs-params">(filepath, callback)</span> -&gt;</span>
    outputPath = filepath + <span class="hljs-string">".tags"</span>
    tags = {}</pre></div>
        
      
        
        <p>File was processed before?</p>

        
          <div class='highlight'><pre>    exists = fs.existsSync outputPath

    <span class="hljs-keyword">if</span> exists?
        <span class="hljs-keyword">if</span> options.overwrite
            <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"already processed, overwrite"</span> <span class="hljs-keyword">if</span> options.verbose
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"already processed, skip"</span> <span class="hljs-keyword">if</span> options.verbose
            <span class="hljs-keyword">return</span></pre></div>
        
      
        
        <p>Detect faces?</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> options.faces
        <span class="hljs-keyword">try</span>
            result = <span class="hljs-keyword">await</span> client.faceDetection filepath
            result = result[<span class="hljs-number">0</span>].faceAnnotations
            result.filepath = filepath</pre></div>
        
      
        
        <p>Iterate faces and add expressions as tags.</p>

        
          <div class='highlight'><pre>            <span class="hljs-keyword">for</span> face <span class="hljs-keyword">in</span> result
                <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> face.description
                    tags[key] = likelyhood[value]

            <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"faces: <span class="hljs-subst">#{JSON.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>)}</span>"</span> <span class="hljs-keyword">if</span> options.verbose
        <span class="hljs-keyword">catch</span> ex
            <span class="hljs-built_in">console</span>.error filepath, <span class="hljs-string">"detect faces"</span>, ex</pre></div>
        
      
        
        <p>Detect labels?</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> options.labels
        <span class="hljs-keyword">try</span>
            result = <span class="hljs-keyword">await</span> client.labelDetection filepath
            result = result[<span class="hljs-number">0</span>].labelAnnotations
            result.filepath = filepath</pre></div>
        
      
        
        <p>Add labels as tags.</p>

        
          <div class='highlight'><pre>            <span class="hljs-keyword">for</span> label <span class="hljs-keyword">in</span> result
                tags[label.description] = label.score.toFixed options.decimals

            <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"labels: <span class="hljs-subst">#{JSON.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>)}</span>"</span> <span class="hljs-keyword">if</span> options.verbose
        <span class="hljs-keyword">catch</span> ex
            <span class="hljs-built_in">console</span>.error filepath, <span class="hljs-string">"detect labels"</span>, ex</pre></div>
        
      
        
        <p>Detect landmarks?</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> options.landmarks
        <span class="hljs-keyword">try</span>
            result = <span class="hljs-keyword">await</span> client.landmarkDetection filepath
            result = result[<span class="hljs-number">0</span>].landmarkAnnotations
            result.filepath = filepath</pre></div>
        
      
        
        <p>Add landmarks as tags.</p>

        
          <div class='highlight'><pre>            <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> result
                <span class="hljs-keyword">for</span> land <span class="hljs-keyword">in</span> r.landmarks
                    tags[land.description] = land.score.toFixed options.decimals

            <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"landmarks: <span class="hljs-subst">#{JSON.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>)}</span>"</span> <span class="hljs-keyword">if</span> options.verbose
        <span class="hljs-keyword">catch</span> ex
            <span class="hljs-built_in">console</span>.error filepath, <span class="hljs-string">"detect landmarks"</span>, ex</pre></div>
        
      
        
        <p>Detect logos?</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> options.logos
        <span class="hljs-keyword">try</span>
            result = <span class="hljs-keyword">await</span> client.logoDetection filepath
            result = result[<span class="hljs-number">0</span>].logoAnnotations
            result.filepath = filepath</pre></div>
        
      
        
        <p>Add logos as tags.</p>

        
          <div class='highlight'><pre>            <span class="hljs-keyword">for</span> logo <span class="hljs-keyword">in</span> result
                tags[logo.description] = logo.score.toFixed options.decimals

            <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"logos: <span class="hljs-subst">#{JSON.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>)}</span>"</span> <span class="hljs-keyword">if</span> options.verbose
        <span class="hljs-keyword">catch</span> ex
            <span class="hljs-built_in">console</span>.error filepath, <span class="hljs-string">"detect logos"</span>, ex</pre></div>
        
      
        
        <p>Detect safe search?</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> options.safe
        <span class="hljs-keyword">try</span>
            result = <span class="hljs-keyword">await</span> client.safeSearchDetection filepath
            result = result[<span class="hljs-number">0</span>].safeSearchAnnotation
            result.filepath = filepath</pre></div>
        
      
        
        <p>Add safe search labels as tags.</p>

        
          <div class='highlight'><pre>            <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> result
                tags[key] = likelyhood[value]
                keys.push key

            <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"safe: <span class="hljs-subst">#{JSON.stringify(result, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>)}</span>"</span> <span class="hljs-keyword">if</span> options.verbose
        <span class="hljs-keyword">catch</span> ex
            <span class="hljs-built_in">console</span>.error filepath, <span class="hljs-string">"detect safe search"</span>, ex</pre></div>
        
      
        
        <p>Output data to JSON.</p>

        
          <div class='highlight'><pre>    outputData = JSON.stringify tags, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span></pre></div>
        
      
        
        <p>Write results to .json file.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">try</span>
        fs.writeFile outputPath, outputData, <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
            <span class="hljs-keyword">if</span> err?
                <span class="hljs-built_in">console</span>.error filepath, <span class="hljs-string">"write file"</span>, err
            <span class="hljs-keyword">else</span>
                <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"processed <span class="hljs-subst">#{Object.keys(tags).length}</span> tags"</span>

            callback()
    <span class="hljs-keyword">catch</span> ex
        <span class="hljs-built_in">console</span>.error filepath, <span class="hljs-string">"write file"</span>, ex</pre></div>
        
      
        
        <p>Scan a folder to match duplicates.</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">scanFolder</span> = <span class="hljs-params">(folder, callback)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> options.verbose
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Scanning <span class="hljs-subst">#{folder}</span> ..."</span></pre></div>
        
      
        
        <p>Helper to scan folder contents (directories and files).</p>

        
          <div class='highlight'><pre><span class="hljs-function">    <span class="hljs-title">scanner</span> = <span class="hljs-params">(file)</span> -&gt;</span>
        filepath = path.join folder, file
        ext = path.extname(filepath).toLowerCase().replace <span class="hljs-string">"."</span>, <span class="hljs-string">""</span>

        <span class="hljs-keyword">try</span>
            stats = fs.statSync filepath

            <span class="hljs-keyword">if</span> stats.isDirectory()
                scanFolder filepath
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">if</span> options.extensions.indexOf(ext) &gt;= <span class="hljs-number">0</span>
                    fileQueue.push filepath
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> options.verbose
                    <span class="hljs-built_in">console</span>.log filepath, <span class="hljs-string">"extensions not included, skip"</span>
        <span class="hljs-keyword">catch</span> ex
            <span class="hljs-built_in">console</span>.error <span class="hljs-string">"Error reading <span class="hljs-subst">#{filepath}</span>: <span class="hljs-subst">#{ex}</span>"</span></pre></div>
        
      
        
        <p>Make sure we have the correct folder path.</p>

        
          <div class='highlight'><pre>    folder = executableFolder + folder <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> path.isAbsolute folder

    <span class="hljs-keyword">try</span>
        contents = fs.readdirSync folder

        <span class="hljs-keyword">if</span> options.verbose
            <span class="hljs-built_in">console</span>.log <span class="hljs-string">"<span class="hljs-subst">#{folder}</span> has <span class="hljs-subst">#{contents.length}</span> itens"</span>

        i = <span class="hljs-number">0</span>
        <span class="hljs-keyword">while</span> i &lt; contents.length
            scanner contents[i]
            i++

        callback <span class="hljs-literal">null</span> <span class="hljs-keyword">if</span> callback?
    <span class="hljs-keyword">catch</span> ex
        <span class="hljs-built_in">console</span>.error <span class="hljs-string">"Error reading <span class="hljs-subst">#{folder}</span>: <span class="hljs-subst">#{ex}</span>"</span>
        callback ex <span class="hljs-keyword">if</span> callback?</pre></div>
        
      
        
        <p>Finished!</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">finished</span> = <span class="hljs-params">(err, result)</span> -&gt;</span>
    duration = (Date.now() - startTime) / <span class="hljs-number">1000</span>

    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Finished after <span class="hljs-subst">#{duration}</span> seconds!"</span></pre></div>
        
      
        
        <p>Bye!</p>

        
          <div class='highlight'><pre>    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span></pre></div>
        
      
        
        <p>Run it!</p>

        
          <div class='highlight'><pre><span class="hljs-function"><span class="hljs-title">run</span> = -&gt;</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"#######################################################"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"###                 - IMGRecog.js -                 ###"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"#######################################################"</span>
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span></pre></div>
        
      
        
        <p>First we get the parameters. If -help, it will end here.</p>

        
          <div class='highlight'><pre>    getParams()</pre></div>
        
      
        
        <p>Passed options.</p>

        
          <div class='highlight'><pre>    arr = []
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> options
        arr.push <span class="hljs-string">"<span class="hljs-subst">#{key}</span>: <span class="hljs-subst">#{value}</span>"</span>

    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Options: <span class="hljs-subst">#{arr.join(<span class="hljs-string">" | "</span>)}</span>"</span>

    credentialsExecutable = executableFolder + <span class="hljs-string">"imgrecog.json"</span>
    credentialsHome = <span class="hljs-string">"~/imgrecog.json"</span>
    credentialsCurrent = currentFolder + <span class="hljs-string">"imgrecog.json"</span></pre></div>
        
      
        
        <p>Create client, checking if a credentials.json file exists.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">try</span>
        <span class="hljs-keyword">if</span> fs.existsSync credentialsCurrent
            client = <span class="hljs-keyword">new</span> vision.ImageAnnotatorClient {keyFilename: credentialsCurrent}
            <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Using credentials from <span class="hljs-subst">#{credentialsCurrent}</span>"</span>
         <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> fs.existsSync credentialsHome
            client = <span class="hljs-keyword">new</span> vision.ImageAnnotatorClient {keyFilename: credentialsHome}
            <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Using credentials from <span class="hljs-subst">#{credentialsHome}</span>"</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> fs.existsSync credentialsExecutable
            client = <span class="hljs-keyword">new</span> vision.ImageAnnotatorClient {keyFilename: credentialsExecutable}
            <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Using credentials from <span class="hljs-subst">#{credentialsExecutable}</span>"</span>
        <span class="hljs-keyword">else</span>
            client = <span class="hljs-keyword">new</span> vision.ImageAnnotatorClient()
            <span class="hljs-built_in">console</span>.log <span class="hljs-string">"Using credentials from environment variables"</span>
    <span class="hljs-keyword">catch</span> ex
        <span class="hljs-built_in">console</span>.error <span class="hljs-string">"Could not create a Vision API client, make sure you have defined credentials on a imgrecog.json file or environment variables."</span>, ex

    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    folderTasks = []</pre></div>
        
      
        
        <p>Iterate and scan search folders.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">for</span> folder <span class="hljs-keyword">in</span> folders
        <span class="hljs-built_in">console</span>.log folder
        <span class="hljs-keyword">do</span> (folder) -&gt; folderTasks.push (callback) -&gt; scanFolder folder, callback

    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span></pre></div>
        
      
        
        <p>Run folder scanning tasks in parallel.</p>

        
          <div class='highlight'><pre>    async.parallelLimit folderTasks, <span class="hljs-number">2</span>

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-literal">true</span></pre></div>
        
      
        
        <p>Unhandled rejections goes here.</p>

        
          <div class='highlight'><pre>process.<span class="hljs-literal">on</span> <span class="hljs-string">"unhandledRejection"</span>, <span class="hljs-function"><span class="hljs-params">(reason, p)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> options.verbose
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">"ERROR!"</span>
        <span class="hljs-built_in">console</span>.log reason
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">console</span>.log <span class="hljs-string">"ERROR!"</span>, reason.message <span class="hljs-keyword">or</span> reason.code <span class="hljs-keyword">or</span> reason

    <span class="hljs-built_in">console</span>.log <span class="hljs-string">""</span>
    process.exit <span class="hljs-number">0</span></pre></div>
        
      
        
        <h2 id="run-baby-run-">Run baby run!</h2>

        
      
        
        
        
          <div class='highlight'><pre>run()</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
