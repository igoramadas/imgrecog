<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>IMGRecog</title>
	<meta name="description" content="Documentation for IMGRecog">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">IMGRecog</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>IMGRecog</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#imgrecog" id="imgrecog" style="color: inherit; text-decoration: none;">
					<h1>IMGRecog</h1>
				</a>
				<p>This is a small Node.js tool to scan and tag images using <a href="https://cloud.google.com/vision">Google Vision</a>, <a href="https://clarifai.com">Clarifai</a> and <a href="https://sightengine.com">Sightengine</a>.</p>
				<a href="#features" id="features" style="color: inherit; text-decoration: none;">
					<h2>Features</h2>
				</a>
				<ul>
					<li>Supports 3 different computer vision APIs: Google Vision, Clarifai and Sightengine</li>
					<li>Results (JSON) are handled as simple tags with a tag name and score (from 0 to 1)</li>
					<li>Can detect objects, labels, landmarks, logos, brands and unsafe content</li>
					<li>Actions to delete or move images according to certain criterias</li>
					<li>Can be used via the command line or programatically</li>
				</ul>
				<a href="#but-why" id="but-why" style="color: inherit; text-decoration: none;">
					<h3>But why?</h3>
				</a>
				<p>Because (as of December 2020) there are no other Node.js based tools that allow you to easily parse and tag images using more than &quot;free&quot; 1 service. Two is better than one, and three is better than two.</p>
				<p>IMGRecog was made by the developer to automate the cleanup tasks of his incoming photos (camera and social media, mostly). Mostly to get rid of bloat and NSFW images. But you can use this tool to whatever suits you best.</p>
				<a href="#what-about-tensorflow" id="what-about-tensorflow" style="color: inherit; text-decoration: none;">
					<h3>What about TensorFlow?</h3>
				</a>
				<p>There are tons of great libraries and tools out there doing computer vision with TensorFlow, and the point here is not to reinvent the wheel. Search for &quot;tensorflow mobilenet&quot; and you&#39;ll find loads. Furthermore, adding TensorFlow as a direct dependecy increases the total package by more than 500%.</p>
				<p>For now, IMGRecog will focus solely on remote APIs.</p>
				<a href="#setup" id="setup" style="color: inherit; text-decoration: none;">
					<h2>Setup</h2>
				</a>
				<p>To install globally on your machine please use:</p>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> -</span><span style="color: #001080">g</span>
</code></pre>
				<p>Or to install locally on your current project:</p>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> --</span><span style="color: #001080">save</span>
</code></pre>
				<a href="#using-the-google-vision-api" id="using-the-google-vision-api" style="color: inherit; text-decoration: none;">
					<h3>Using the Google Vision API</h3>
				</a>
				<p>You&#39;ll need to download your Google Cloud Vision API credentials file from the Google Cloud Console. If you need help please follow <a href="https://cloud.google.com/vision/docs/auth">these instructions</a>.</p>
				<p>Set the path to the credentials file using the <code>googleKeyfile</code> option, or via the command line arg <code>--glgkeyfile</code>.</p>
				<a href="#using-the-clarifai-api" id="using-the-clarifai-api" style="color: inherit; text-decoration: none;">
					<h3>Using the Clarifai API</h3>
				</a>
				<p>If you want to process images with the Clarifai API, please get the API key for your app on the <a href="https://portal.clarifai.com">Portal</a>. Set it via the option <code>clarifaiKey</code>, or via the command line arg <code>--clakey</code>.</p>
				<a href="#using-the-sightengine-api" id="using-the-sightengine-api" style="color: inherit; text-decoration: none;">
					<h3>Using the Sightengine API</h3>
				</a>
				<p>If you want to process images with the Sightengine API, please get your API user and secret from your <a href="https://dashboard.sightengine.com/api-credentials">Dashboard</a>. Set them via the options <code>sightengineUser</code> and <code>sightengineSecret</code>, or via the command line args <code>--steuser</code> and <code>--stesecret</code>.</p>
				<a href="#command-line-usage" id="command-line-usage" style="color: inherit; text-decoration: none;">
					<h2>Command line usage</h2>
				</a>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> -[</span><span style="color: #001080">options</span><span style="color: #000000">] --[</span><span style="color: #001080">actions</span><span style="color: #000000">] </span><span style="color: #001080">folders</span>
</code></pre>
				<p>Detect logos in the current directory, using Google Vision, credentials from auth.json file:</p>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> --</span><span style="color: #001080">logos</span><span style="color: #000000"> --</span><span style="color: #001080">glgkeyfile</span><span style="color: #000000"> ./</span><span style="color: #001080">auth</span><span style="color: #000000">.</span><span style="color: #001080">json</span><span style="color: #000000"> .</span>
</code></pre>
				<p>Detect unsafe images under the user&#39;s home folder, using Clarifai and Sightengine:</p>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> --</span><span style="color: #001080">unsafe</span><span style="color: #000000"> --</span><span style="color: #001080">clakey</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;123&quot;</span><span style="color: #000000"> --</span><span style="color: #001080">steuser</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;abc&quot;</span><span style="color: #000000"> --</span><span style="color: #001080">stesecret</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;abc1234&quot;</span><span style="color: #000000"> ~/</span>
</code></pre>
				<p>Detect and delete images unlikely to have a beach, trasversing the user&#39;s home folder, loading options from the imgrecog.options.json file:</p>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> -</span><span style="color: #001080">d</span><span style="color: #000000"> --</span><span style="color: #001080">labels</span><span style="color: #000000"> --</span><span style="color: #001080">landmarks</span><span style="color: #000000"> --</span><span style="color: #001080">filter</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;beach &lt; 0.5&quot;</span><span style="color: #000000"> ~/</span>
</code></pre>
				<p>Detect everything on camera and downloads folder, limiting to 15k API calls, and then move porn and bloat images to the trash folder:</p>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> --</span><span style="color: #001080">all</span><span style="color: #000000"> --</span><span style="color: #001080">deep</span><span style="color: #000000"> \</span>
<span style="color: #000000">           --</span><span style="color: #001080">glgkeyfile</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;mycredentials.json&quot;</span><span style="color: #000000"> \</span>
<span style="color: #000000">           --</span><span style="color: #001080">clakey</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;123&quot;</span><span style="color: #000000"> \</span>
<span style="color: #000000">           --</span><span style="color: #001080">steuser</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;abc&quot;</span><span style="color: #000000"> \</span>
<span style="color: #000000">           --</span><span style="color: #001080">stesecret</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;abc1234&quot;</span><span style="color: #000000"> \</span>
<span style="color: #000000">           --</span><span style="color: #001080">limit</span><span style="color: #000000"> </span><span style="color: #098658">15000</span><span style="color: #000000"> \</span>
<span style="color: #000000">           --</span><span style="color: #001080">filter</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;is-bloat, is-porn&quot;</span><span style="color: #000000"> \</span>
<span style="color: #000000">           --</span><span style="color: #001080">move</span><span style="color: #000000"> ~/</span><span style="color: #001080">trash</span><span style="color: #000000"> \</span>
<span style="color: #000000">           ~/</span><span style="color: #001080">camera</span><span style="color: #000000"> ~/</span><span style="color: #001080">downloads</span>
</code></pre>
				<p>Dry run with the results from a previous execution.</p>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> --</span><span style="color: #001080">dry</span><span style="color: #000000"> --</span><span style="color: #001080">move</span><span style="color: #000000"> --</span><span style="color: #001080">filter</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;is-bloat&quot;</span>
</code></pre>
				<p>For help and the full list of options, ask for help:</p>
				<pre><code><span style="color: #001080">$</span><span style="color: #000000"> </span><span style="color: #001080">imgrecog</span><span style="color: #000000"> --</span><span style="color: #001080">help</span>
</code></pre>
				<a href="#importing-as-a-library" id="importing-as-a-library" style="color: inherit; text-decoration: none;">
					<h2>Importing as a library</h2>
				</a>
				<pre><code class="language-javascript"><span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">ImgRecog</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&quot;imgrecog&quot;</span>
<span style="color: #008000">// const ImgRecog = require(&quot;imgrecog&quot;).default</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">options</span><span style="color: #000000"> = {</span>
<span style="color: #000000">    </span><span style="color: #001080">folders:</span><span style="color: #000000"> [</span><span style="color: #A31515">&quot;/home/user1/photos&quot;</span><span style="color: #000000">, </span><span style="color: #A31515">&quot;/home/user2/photos&quot;</span><span style="color: #000000">],</span>
<span style="color: #000000">    </span><span style="color: #001080">limit:</span><span style="color: #000000"> </span><span style="color: #098658">5000</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">unsafe:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span>
<span style="color: #000000">    </span><span style="color: #008000">// more options...</span>
<span style="color: #000000">}</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">processor</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">ImgRecog</span><span style="color: #000000">(</span><span style="color: #001080">options</span><span style="color: #000000">)</span>
<span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">processor</span><span style="color: #000000">.</span><span style="color: #795E26">run</span><span style="color: #000000">()</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">dir</span><span style="color: #000000">(</span><span style="color: #001080">processor</span><span style="color: #000000">.</span><span style="color: #001080">results</span><span style="color: #000000">)</span>
</code></pre>
				<a href="#loading-options" id="loading-options" style="color: inherit; text-decoration: none;">
					<h2>Loading options</h2>
				</a>
				<p>IMGRecog will look for a <code>imgrecog.options.json</code> file on the following places:</p>
				<ul>
					<li>where the tool is installed</li>
					<li>current user&#39;s home folder</li>
					<li>current executing directory</li>
				</ul>
				<p>If not found, it will assume all the default options.</p>
				<p>When running from the command line, options should be passed as arguments or via environment variables with the &quot;IMGRECOG_&quot; prefix (examples: <code>IMGRECOG_LIMIT</code>, <code>IMGRECOG_VERBOSE</code> etc).</p>
				<a href="#options" id="options" style="color: inherit; text-decoration: none;">
					<h2>Options</h2>
				</a>
				<a href="#console" id="console" style="color: inherit; text-decoration: none;">
					<h3>console</h3>
				</a>
				<p>Enable or disable logging to the console. Enabled by default when using via the command line, but not when using it as a library / programatically.</p>
				<a href="#extensions--e" id="extensions--e" style="color: inherit; text-decoration: none;">
					<h3>extensions <em><code>-e</code></em></h3>
				</a>
				<p>File extensions should be scanned. Defaults to common image files: <code>&quot;png&quot;, &quot;jpg&quot;, &quot;jpeg&quot;, &quot;gif&quot;, &quot;bmp&quot;</code></p>
				<a href="#output--o" id="output--o" style="color: inherit; text-decoration: none;">
					<h3>output <em><code>-o</code></em></h3>
				</a>
				<p>Full path to the output file with the scanning results. Defaults to <code>imgrecog.results.json</code> on the current folder.</p>
				<a href="#limit--l" id="limit--l" style="color: inherit; text-decoration: none;">
					<h3>limit <em><code>-l</code></em></h3>
				</a>
				<p>Limit API calls to the Google Vision API, as a safe $$ precaution. Defaults to <code>1000</code> calls per API / execution.</p>
				<a href="#parallel--p" id="parallel--p" style="color: inherit; text-decoration: none;">
					<h3>parallel <em><code>-p</code></em></h3>
				</a>
				<p>How many files can be processed in parallel. Defaults to <code>5</code>.</p>
				<a href="#deep--d" id="deep--d" style="color: inherit; text-decoration: none;">
					<h3>deep <em><code>-d</code></em></h3>
				</a>
				<p>Include subfolders when scanning. Defaults to <code>false</code>.</p>
				<a href="#verbose--v" id="verbose--v" style="color: inherit; text-decoration: none;">
					<h3>verbose <em><code>-v</code></em></h3>
				</a>
				<p>Activate verbose mode with extra logging. Defaults to <code>false</code>.</p>
				<a href="#dry---dry" id="dry---dry" style="color: inherit; text-decoration: none;">
					<h3>dry <em><code>--dry</code></em></h3>
				</a>
				<p>Dry run, if you set this to true it will parse the existing results instead of running the detection process again. Useful to test filters and actions.</p>
				<a href="#authentication" id="authentication" style="color: inherit; text-decoration: none;">
					<h2>Authentication</h2>
				</a>
				<a href="#googlekeyfile---glgkeyfile" id="googlekeyfile---glgkeyfile" style="color: inherit; text-decoration: none;">
					<h3>googleKeyfile <em><code>--glgkeyfile</code></em></h3>
				</a>
				<p>Path to the credentials keyfile used to authenticate with the Google. Defaults to none (disable Google Vision).</p>
				<a href="#clarifaikey---clakey" id="clarifaikey---clakey" style="color: inherit; text-decoration: none;">
					<h3>clarifaiKey <em><code>--clakey</code></em></h3>
				</a>
				<p>API key to be used with the Clarifai API. Defaults to none (disable Clarifai).</p>
				<a href="#sightengineuser---steuser" id="sightengineuser---steuser" style="color: inherit; text-decoration: none;">
					<h3>sightengineUser <em><code>--steuser</code></em></h3>
				</a>
				<p>API user to be used with the Sightengine API. Defaults to none (disable Sightengine).</p>
				<a href="#sightenginesecret---stesecret" id="sightenginesecret---stesecret" style="color: inherit; text-decoration: none;">
					<h3>sightengineSecret <em><code>--stesecret</code></em></h3>
				</a>
				<p>API secret to be used for the Sightengine API. Defaults to none (disable Sightengine).</p>
				<a href="#detection-features" id="detection-features" style="color: inherit; text-decoration: none;">
					<h2>Detection features</h2>
				</a>
				<a href="#objects---objects" id="objects---objects" style="color: inherit; text-decoration: none;">
					<h3>objects <em><code>--objects</code></em></h3>
				</a>
				<p>Detect objects and things on the scanned images.</p>
				<a href="#labels---labels" id="labels---labels" style="color: inherit; text-decoration: none;">
					<h3>labels <em><code>--labels</code></em></h3>
				</a>
				<p>Detect labels and general tags on the scanned images.</p>
				<a href="#landmarks---landmarks" id="landmarks---landmarks" style="color: inherit; text-decoration: none;">
					<h3>landmarks <em><code>--landmarks</code></em></h3>
				</a>
				<p>Detect landmarks and famous locations on the scanned images.</p>
				<a href="#logos---logos" id="logos---logos" style="color: inherit; text-decoration: none;">
					<h3>logos <em><code>--logos</code></em></h3>
				</a>
				<p>Detect logos and brands on the scanned images.</p>
				<a href="#unsafe---unsafe" id="unsafe---unsafe" style="color: inherit; text-decoration: none;">
					<h3>unsafe <em><code>--unsafe</code></em></h3>
				</a>
				<p>Detect unsafe images with explicit content (adult, violence, medical, racy, spoof).</p>
				<a href="#all---all" id="all---all" style="color: inherit; text-decoration: none;">
					<h3>all <em><code>--all</code></em></h3>
				</a>
				<p>Shortcut to enable all detections via the command line.</p>
				<a href="#actions" id="actions" style="color: inherit; text-decoration: none;">
					<h2>Actions</h2>
				</a>
				<a href="#filter---filter" id="filter---filter" style="color: inherit; text-decoration: none;">
					<h3>filter <em><code>--filter</code></em></h3>
				</a>
				<p>Tag based filter to be applied on the image results, mandatory if you want to use the <code>move</code> or <code>delete</code> actions below. Multiple conditions can be defined, separated by comma. Examples:</p>
				<ul>
					<li><code>summer</code> - summer images</li>
					<li><code>summer, !beach</code> - summer images, but no definetely no beach</li>
					<li><code>summer &gt; 0.93, beach &lt; 0.5</code> - same as above, but using specific scores</li>
					<li><code>is-porn, is-bloat</code> - images that are categorized as porn or bloat</li>
				</ul>
				<p>Note that spaces are ignored.</p>
				<a href="#move---move" id="move---move" style="color: inherit; text-decoration: none;">
					<h3>move <em><code>--move</code></em></h3>
				</a>
				<p>Move the images that match the filter, replicating their original path. For example if you set move to <code>/var/photos/scanned</code>, then an image <code>/home/someuser/photos/dsc123.jpg</code> will be moved to <code>/var/photos/scanned/home/someuser/photos/dsc123.jpg</code>.</p>
				<a href="#delete---delete" id="delete---delete" style="color: inherit; text-decoration: none;">
					<h3>delete <em><code>--delete</code></em></h3>
				</a>
				<p>Delete the images that match the filter.</p>
				<a href="#interpreting-results" id="interpreting-results" style="color: inherit; text-decoration: none;">
					<h2>Interpreting results</h2>
				</a>
				<p>After the scanning has finished, the JSON results will be saved to the specified <code>output</code> path. By default, this is the file &quot;imgrecog.results.json&quot; on the current directory.</p>
				<p>Each scanning result has the following schema:</p>
				<ul>
					<li>file - the full path to the scanned image file</li>
					<li>size - fize size in bytes</li>
					<li>tags - map of tags and scores for the scanned image</li>
					<li>error - list of errors (field will be ommited if no errors occurred)</li>
				</ul>
				<a href="#need-help" id="need-help" style="color: inherit; text-decoration: none;">
					<h2>Need help?</h2>
				</a>
				<p>Post an issue <a href="https://github.com/igoramadas/imgrecog/issues">here</a>.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/actions.html">actions</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/categorizer.html">categorizer</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/clarifai.html">clarifai</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/cmd.html">cmd</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/index.html">index</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/sightengine.html">sightengine</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/types.html">types</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils.html">utils</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/vision.html">vision</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>